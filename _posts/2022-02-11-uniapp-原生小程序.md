---
title: uniapp、原生小程序混合开发
author: ralbatr
date: 2022-02-11 05:05:28 +0800
categories: [技术]
tags: [随笔]
toc: false
---

----
##### 因为业务需求，新开发的功能需要支持多平台，而原来的是原声写的小程序。公司现在基本框架是使用VUE写，所以倾向使用uniapp。网上找了很多方案，无非三种，
-   1、原生小程序转成uniapp，有第三方工具。问题：只是转成uniapp后，无法在运行小程序。而且第三方不保证效果。
-   2、uniapp开发新功能，新开发的功能发不成H5，放到web-view中。这个后面详细说。
-   3、uniapp开发新功能，新功能转成原生小程序集成到原生里面。有点，可以使用原生的功能，uniapp还可以继续开发别的平台。最后采用这种方式。

#### 最初选择方案2，因为现在H5性能也跟的上了。但是遇到了几个问题，最初的都解决了。但是有几个微信压根不支持。
##### 1、小程序跟web-view的双向通信，小程序打开web-view携带参数，这个容易实现。但是web-view打开小程序，然后，小程序返回，并携带数据返回，这个没有好的优雅解决方法。
##### 2、web-view 一些使用微信的能力受限制。
#### 既然，方案2行不通，那就只有1、3了。方案1，这个基本是彻底放弃原生开发了。如果有这个需求，可以苦一次，彻底转，但是我们主要是新功能使用uniapp开发。所以尝试方案3。

#### 其实，方案三理论上很容易理解。uniapp运行起来还是在小程序开发工具上，内部只是hook了小程序的生命周期，然后，把vue转成小程序的格式文件。那么我们只需要把必要的库文件和page文件移动过去即可。具体步骤如下：

- 1、运行小程序，注意不是发布，发布会压缩js，导致不可读。
- 2、首先把common库文件添加到原来的小程序中。并在app.js最上方倒入。
- 3、倒入pages，建议专门新建一个文件夹存放，但是新建文件夹也有一个问题，层级关系加了一层。以后需要注意。当然，也可以在uniapp中新建一层目录，这样就对称了。方便移植。
- 4、新添加的pages，在app.json注册。注意层级关系不要错了。
- 5、如果在uniapp中使用了其他库或者ui，也要添加过来。
###### 其他的细节，比如使用原生的库，或者差异编码，可以使用多平台开发条件编译。

###### 在html中微信小程序起作用
```
<!-- #ifdef MP-WEIXIN -->
<!-- #endif -->
```

###### 在js中微信小程序起作用
~~~
// #ifdef MP-WEIXIN
// #endif
~~~


###### 在样式中微信小程序起作用
~~~
/* #ifdef MP-WEIXIN */
/* #endif */
~~~

#### 以上就是在这次开发过程中总结的经验




> 参考 ：https://uniapp.dcloud.net.cn/hybrid   